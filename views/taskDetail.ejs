<!DOCTYPE html>

<head>
  <title> Main Page </title>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Jost:wght@500&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="../css/taskDetail.css" />
</head>
<body>
  <% refresh() %>
  <%let countOfAssignment =assigments.length%>
  <%let coutOfDoneAssignment = 0 %>
  <%assigments.forEach((elem, inedx, arr) => {%>
     <%if(elem.wykonanie == 'DONE') {%>
      <%console.log("BACKEND | FIND DONE ")%>
       <%coutOfDoneAssignment += 1%>
      <%}%>
    <%})%>
    <%let forProcessBar = (coutOfDoneAssignment/countOfAssignment)*100 %>
    <%console.log("BACKEND | count all ", countOfAssignment)%>
    <%console.log("BACKEND | count Done ", coutOfDoneAssignment)%>
    <%console.log("BACKEND | Procent ", forProcessBar)%>
    <div id="conent">
    <div id="top">
      <nav id="menu">
        <li class="option"><a href="/loading_adm" class="option">Back</a></li>
      </nav>
    </div>
    <% tasks.forEach((elem, index, arr) => {%>
      <%if(tasks[index] == witch){%>
          <div id="rest">
            <div id="left">
              <div id="team">
                <div id="teamTop">Task Team</div>
                <div id="teamPersons">
                  <%for(let i=0; i<=teamUser.length; i++){%>
                    <%if(teamTask[i] == witch){%>
                      <div id="person">
                        <div id="name"><%-teamUser[i]%></div>
                        <form action="/deleteteammate" method="POST">
                          <input type="hidden" name="nick" value="<%-teamUser[i]%>" id="nick"></input>
                          <input type="hidden" name="task" value="<%-elem%>" id="nick"></input>
                          <button id="delete" type="submit">X</button>
                        </form>
                      </div>
                      <%console.log(teamUser)%>
                      <%console.log(teamTask)%>
                    <%}%>
                  <%}%>
                </div>
                <div id="add">
                  <form action="/addteammate" method="POST">
                    <div id="add">
                       <input type="text" name="nick" placeholder="Login" id="nick"></input>
                       <input type="hidden" name="task" value="<%-elem%>" id="nick"></input>
                       <button id="ADD" type="submit">ADD</button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
            <div id="right">
              <div id="rightTop">Nazwa:<%-elem%></div>
              <div id="rightMiddle">
                <div id="subtasks">
                  <form method="POST" action="/modifyAssignment" id="AssigmentsForm">
                    <div id="subtaskContent">
                      <%assigments.forEach((elem,index,arr) => {%>
                        <%if (elem.task == witch) {%>
                            <div id="subtask">
                                <%if(elem.wykonanie == 'DONE'){%>
                                  <input type="hidden" id="<%-elem.nazwa%>" name="assignment" value="<%-elem.nazwa%>">
                                  <div id="labeldone"> <%-elem.nazwa%></div>
                                 <%} else {%>
                                  <input type="checkbox" id="<%-elem.nazwa%>" name="assignment" value="<%-elem.nazwa%>">
                                  <div id="label"> <%-elem.nazwa%></div>
                                 <%}%>
                            </div>
                          <%}%>
                        <%})%>
                    </div>
                    <div id="subtaskButton">
                      <button id="ADD" type="submit">SUBBMIT</button>
                    </div>
                  </form>
                </div>
                <div id="addSubtask">
                  <form action="/addAssignments" method="POST">
                    <input type="text" name="assignment" placeholder="assignment" id="nick"></input>
                    <input type="hidden" name="task" value="<%-elem%>" id="nick"></input>
                    <button id="ADD" type="submit">ADD</button>
                  </form>
                </div>
              </div>
              <div id="rightbottom">
                <div id="bottomTop">Progress:</div>
                <div id="bottomBot"><progress value="<%-forProcessBar%>" max="100"></progress></div>
              </div>
            </div>
          </div>
        <%}%>
    <%})%>
  </div>

</body>

</html>